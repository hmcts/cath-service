generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Artefact {
  artefactId        String            @id @default(uuid()) @map("artefact_id") @db.Uuid
  locationId        String            @map("location_id")
  listTypeId        Int               @map("list_type_id")
  contentDate       DateTime          @map("content_date") @db.Date
  sensitivity       String
  language          String
  displayFrom       DateTime          @map("display_from")
  displayTo         DateTime          @map("display_to")
  lastReceivedDate  DateTime          @default(now()) @map("last_received_date")
  isFlatFile        Boolean           @map("is_flat_file")
  provenance        String
  supersededCount   Int               @default(0) @map("superseded_count")
  noMatch           Boolean           @default(false) @map("no_match")
  ingestionLogs     IngestionLog[]
  artefactSearches  ArtefactSearch[]

  @@map("artefact")
}

model ArtefactSearch {
  id         String    @id @default(uuid())
  artefactId String    @map("artefact_id") @db.Uuid
  caseNumber String?   @map("case_number")
  caseName   String?   @map("case_name")
  createdAt  DateTime  @default(now()) @map("created_at")

  artefact Artefact @relation(fields: [artefactId], references: [artefactId], onDelete: Cascade)

  @@index([artefactId])
  @@map("artefact_search")
}

model User {
  userId             String         @id @default(uuid()) @map("user_id") @db.Uuid
  email              String         @db.VarChar(255)
  firstName          String?        @map("first_name") @db.VarChar(255)
  surname            String?        @db.VarChar(255)
  userProvenance     String         @map("user_provenance") @db.VarChar(20)
  userProvenanceId   String         @unique @map("user_provenance_id") @db.VarChar(255)
  role               String         @db.VarChar(20)
  createdDate        DateTime       @default(now()) @map("created_date")
  lastSignedInDate   DateTime?      @map("last_signed_in_date")

  subscriptions Subscription[]

  @@map("user")
}

model MediaApplication {
  id                      String    @id @default(uuid()) @db.Uuid
  name                    String    @db.VarChar(255)
  email                   String    @db.VarChar(255)
  employer                String    @db.VarChar(255)
  proofOfIdPath           String?   @map("proof_of_id_path") @db.VarChar(500)
  proofOfIdOriginalName   String?   @map("proof_of_id_original_name") @db.VarChar(255)
  status                  String    @default("PENDING") @db.VarChar(20)
  appliedDate             DateTime  @default(now()) @map("applied_date")

  @@map("media_application")
}

model IngestionLog {
  id            String     @id @default(uuid()) @map("id") @db.Uuid
  timestamp     DateTime   @default(now()) @map("timestamp")
  sourceSystem  String     @map("source_system")
  courtId       String     @map("court_id")
  status        String     @map("status")
  errorMessage  String?    @map("error_message")
  artefactId    String?    @map("artefact_id") @db.Uuid
  artefact      Artefact?  @relation(fields: [artefactId], references: [artefactId], onDelete: SetNull)

  @@index([timestamp])
  @@index([status])
  @@index([sourceSystem])
  @@map("ingestion_log")
}

model LegacyThirdPartyUser {
  id          String   @id @default(uuid()) @map("id") @db.Uuid
  name        String   @db.VarChar(255)
  createdDate DateTime @default(now()) @map("created_date")

  subscriptions LegacyThirdPartySubscription[]

  @@map("legacy_third_party_user")
}

model LegacyThirdPartySubscription {
  id          String   @id @default(uuid()) @map("id") @db.Uuid
  userId      String   @map("user_id") @db.Uuid
  listTypeId  Int      @map("list_type_id")
  channel     String   @default("API") @db.VarChar(20)
  sensitivity String   @db.VarChar(20)
  createdDate DateTime @default(now()) @map("created_date")

  user LegacyThirdPartyUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([listTypeId])
  @@map("legacy_third_party_subscription")
}

