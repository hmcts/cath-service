generator client {
  provider = "prisma-client-js"
  output   = "../../../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Artefact {
  artefactId        String          @id @default(uuid()) @map("artefact_id") @db.Uuid
  locationId        String          @map("location_id")
  listTypeId        Int             @map("list_type_id")
  contentDate       DateTime        @map("content_date") @db.Date
  sensitivity       String
  language          String
  displayFrom       DateTime        @map("display_from")
  displayTo         DateTime        @map("display_to")
  lastReceivedDate  DateTime        @default(now()) @map("last_received_date")
  isFlatFile        Boolean         @map("is_flat_file")
  provenance        String
  supersededCount   Int             @default(0) @map("superseded_count")
  noMatch           Boolean         @default(false) @map("no_match")
  ingestionLogs     IngestionLog[]

  @@map("artefact")
}

model User {
  userId             String         @id @default(uuid()) @map("user_id") @db.Uuid
  email              String         @db.VarChar(255)
  firstName          String?        @map("first_name") @db.VarChar(255)
  surname            String?        @db.VarChar(255)
  userProvenance     String         @map("user_provenance") @db.VarChar(20)
  userProvenanceId   String         @unique @map("user_provenance_id") @db.VarChar(255)
  role               String         @db.VarChar(20)
  createdDate        DateTime       @default(now()) @map("created_date")
  lastSignedInDate   DateTime?      @map("last_signed_in_date")

  subscriptions Subscription[]

  @@map("user")
}

model MediaApplication {
  id          String   @id @default(uuid()) @db.Uuid
  fullName    String   @map("full_name")
  email       String
  employer    String
  status      String   @default("PENDING")
  requestDate DateTime @default(now()) @map("request_date")
  statusDate  DateTime @default(now()) @map("status_date")

  @@map("media_application")
}

model IngestionLog {
  id            String     @id @default(uuid()) @map("id") @db.Uuid
  timestamp     DateTime   @default(now()) @map("timestamp")
  sourceSystem  String     @map("source_system")
  courtId       String     @map("court_id")
  status        String     @map("status")
  errorMessage  String?    @map("error_message")
  artefactId    String?    @map("artefact_id") @db.Uuid
  artefact      Artefact?  @relation(fields: [artefactId], references: [artefactId], onDelete: SetNull)

  @@index([timestamp])
  @@index([status])
  @@index([sourceSystem])
  @@map("ingestion_log")
}

model Subscription {
  id           String   @id @default(uuid()) @map("id") @db.Uuid
  locationId   String   @map("location_id")
  userId       String   @map("user_id") @db.Uuid
  user         User     @relation(fields: [userId], references: [userId], onDelete: Cascade)
  createdDate  DateTime @default(now()) @map("created_date")

  @@unique([locationId, userId])
  @@map("subscription")
}

