# Pipeline Deployment Helm Values
# This file is used by Flux for non-prod and prod deployments
# For local development, see values.dev.yaml

nodejs:
  applicationPort: 8080
  aadIdentityName: cath
  ingressHost: cath-web.{{ .Values.global.environment }}.platform.hmcts.net
  image: 'hmctspublic.azurecr.io/cath/cath-web:latest'

  # Single pod deployment required due to ephemeral filesystem storage
  # Files are stored in container storage at storage/temp/uploads/
  # Multiple pods would have isolated filesystems causing file access issues
  # TODO: Enable autoscaling after Azure Blob Storage implementation (follow-up ticket)
  replicas: 1
  autoscaling:
    enabled: false

  environment:
    REDIS_HOST: 'cath-{{ .Values.global.environment }}.redis.cache.windows.net'
    BASE_URL: 'https://{{ .Values.nodejs.ingressHost }}'
    SSO_ALLOW_HTTP_REDIRECT: 'false'
  keyVaults:
    # Using pip-ss-kv-stg for time being, once pipeline properly setup, stg will be replaced by environment
    pip-ss-kv-stg:
      secrets:
        # Infrastructure secrets will be enabled later
        # - redis-access-key
        # - app-insights-connection-string
        # - dynatrace-url

        # SSO secrets (production names without -dev suffix)
        - name: sso-client-id
          alias: SSO_CLIENT_ID
        - name: sso-client-secret
          alias: SSO_CLIENT_SECRET
        - name: sso-issuer-url
          alias: SSO_IDENTITY_METADATA
        - name: sso-sg-system-admin
          alias: SSO_SYSTEM_ADMIN_GROUP_ID
        - name: sso-sg-admin-ctsc
          alias: SSO_INTERNAL_ADMIN_CTSC_GROUP_ID
        - name: sso-sg-admin-local
          alias: SSO_INTERNAL_ADMIN_LOCAL_GROUP_ID
