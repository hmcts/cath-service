# Pipeline Deployment Helm Values
# This file is used by Flux for non-prod and prod deployments
# For local development, see values.dev.yaml

nodejs:
  applicationPort: 8080
  aadIdentityName: cath
  ingressHost: cath-web.{{ .Values.global.environment }}.platform.hmcts.net
  image: 'hmctspublic.azurecr.io/cath/cath-web:latest'

  # Single pod deployment required due to ephemeral filesystem storage
  # Files are stored in container storage at storage/temp/uploads/
  # Multiple pods would have isolated filesystems causing file access issues
  # TODO: Enable autoscaling after Azure Blob Storage implementation (follow-up ticket)
  replicas: 1
  autoscaling:
    enabled: false

  environment:
    REDIS_HOST: 'cath-{{ .Values.global.environment }}.redis.cache.windows.net'
    BASE_URL: 'https://{{ .Values.nodejs.ingressHost }}'
    SSO_ALLOW_HTTP_REDIRECT: 'false'
    MEDIA_FORGOT_PASSWORD_LINK: 'https://sign-in.pip-frontend.staging.platform.hmcts.net/pip-frontend.staging.platform.hmcts.net/oauth2/v2.0/authorize?p=B2C_1A_PASSWORD_RESET&client_id=cae650ba-431b-4fc8-be14-22d476ebd31b&nonce=defaultNonce&redirect_uri=https://pip-frontend.staging.platform.hmcts.net/password-change-confirmation&scope=openid&response_type=code&prompt=login&response_mode=form_post'
    GOVUK_NOTIFY_TEMPLATE_ID_MEDIA_REJECTION: '1988bbdd-d223-49bf-912f-ed34cb43e35e'
    GOVUK_NOTIFY_TEMPLATE_ID_MEDIA_NEW_ACCOUNT: '689c0183-0461-423e-a542-de513a93a5b7'
    GOVUK_NOTIFY_TEMPLATE_ID_MEDIA_EXISTING_USER: '13b058a5-82da-4331-98ff-97d3ebf66f51'
  keyVaults:
    # Using pip-ss-kv-stg for time being, once pipeline properly setup, stg will be replaced by environment
    pip-ss-kv-stg:
      secrets:
        # Infrastructure secrets will be enabled later
        # - redis-access-key
        # - app-insights-connection-string
        # - dynatrace-url

        # SSO secrets (production names without -dev suffix)
        - name: sso-client-id
          alias: SSO_CLIENT_ID
        - name: sso-client-secret
          alias: SSO_CLIENT_SECRET
        - name: sso-issuer-url
          alias: SSO_IDENTITY_METADATA
        - name: sso-sg-system-admin
          alias: SSO_SYSTEM_ADMIN_GROUP_ID
        - name: sso-sg-admin-ctsc
          alias: SSO_INTERNAL_ADMIN_CTSC_GROUP_ID
        - name: sso-sg-admin-local
          alias: SSO_INTERNAL_ADMIN_LOCAL_GROUP_ID

        # Azure AD B2C secrets (media user account management)
        - name: b2c-tenant-id
          alias: AZURE_B2C_TENANT_ID
        - name: auto-pip-stg-pip-account-management-stg-id
          alias: AZURE_B2C_CLIENT_ID
        - name: auto-pip-stg-pip-account-management-stg-pwd
          alias: AZURE_B2C_CLIENT_SECRET
        - name: b2c-ad-url
          alias: AZURE_B2C_DOMAIN
