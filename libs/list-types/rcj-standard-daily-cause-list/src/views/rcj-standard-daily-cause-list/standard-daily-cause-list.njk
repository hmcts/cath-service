{% extends "layouts/base-template.njk" %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/details/macro.njk" import govukDetails %}

{% block head %}
  {{ super() }}
  <style>
    .back-to-top {
      margin-top: 40px;
    }
    .search-container {
      margin-top: 32px;
      margin-bottom: 32px;
    }
  </style>
{% endblock %}

{% block page_content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">

    <h1 class="govuk-heading-l" id="top">{{ header.listTitle }}</h1>

    {# Special content for Civil Courts at the RCJ and County Court Central London - List Type IDs 10 & 11 #}
    {% if listTypeId == 10 or listTypeId == 11 %}
    <p class="govuk-body">
      <a href="{{ listContent.factLinkUrl }}" class="govuk-link">{{ listContent.factLinkText }}</a> {{ listContent.factAdditionalText }}
    </p>

    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-bottom-0">{{ listContent.locationLine1 }}</p>
    <p class="govuk-body govuk-!-margin-bottom-0">{{ listContent.locationLine2 }}</p>
    <p class="govuk-body {% if listContent.locationLine4 %}govuk-!-margin-bottom-0{% endif %}">{{ listContent.locationLine3 }}</p>
    {% if listContent.locationLine4 %}
    <p class="govuk-body">{{ listContent.locationLine4 }}</p>
    {% endif %}
    {% endif %}

    {# Special content for Court of Appeal (Criminal Division) - List Type ID 12 #}
    {% if listTypeId == 12 %}
    {# 1. FaCT link #}
    <p class="govuk-body">
      <a href="{{ listContent.factLinkUrl }}" class="govuk-link">{{ listContent.factLinkText }}</a> {{ listContent.factAdditionalText }}
    </p>

    {# 2. Address #}
    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-bottom-0">{{ listContent.locationLine1 }}</p>
    <p class="govuk-body govuk-!-margin-bottom-0">{{ listContent.locationLine2 }}</p>
    <p class="govuk-body">{{ listContent.locationLine3 }}</p>

    {# 3. Dates #}
    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-bottom-1 govuk-!-margin-top-4">{{ header.listDate }}</p>
    <p class="govuk-body">{{ header.lastUpdated }}</p>

    {# 4. Important information #}
    {{ govukDetails({
      summaryText: listContent.importantInfoTitle,
      html: '<p class="govuk-body">' + listContent.importantInfoText + '</p><p class="govuk-body">' + listContent.quickGuideText + ' <a href="' + listContent.quickGuideLinkUrl + '" class="govuk-link" target="_blank" rel="noopener noreferrer">' + listContent.quickGuideLinkText + '</a></p>',
      open: true
    }) }}

    {# Special content for Family Division High Court - List Type ID 13 #}
    {% elif listTypeId == 13 %}
    {# 1. FaCT link #}
    <p class="govuk-body">
      <a href="{{ listContent.factLinkUrl }}" class="govuk-link">{{ listContent.factLinkText }}</a> {{ listContent.factAdditionalText }}
    </p>

    {# 2. Address #}
    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-bottom-0">{{ listContent.locationLine1 }}</p>
    <p class="govuk-body govuk-!-margin-bottom-0">{{ listContent.locationLine2 }}</p>
    <p class="govuk-body">{{ listContent.locationLine3 }}</p>

    {# 3. Dates #}
    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-bottom-1 govuk-!-margin-top-4">{{ header.listDate }}</p>
    <p class="govuk-body">{{ header.lastUpdated }}</p>

    {# 4. Important information #}
    {{ govukDetails({
      summaryText: listContent.importantInfoTitle,
      html: '<p class="govuk-body">' + listContent.generalHearingRulesText.split('\n\n').join('</p><p class="govuk-body">') + '</p><h3 class="govuk-heading-s govuk-!-margin-top-6">' + listContent.courtOfProtectionTitle + '</h3><p class="govuk-body">' + listContent.courtOfProtectionText.split('\n\n').join('</p><p class="govuk-body">') + '</p><h3 class="govuk-heading-s govuk-!-margin-top-6">' + listContent.tipstaffTitle + '</h3><p class="govuk-body">' + listContent.tipstaffText.split('\n\n').join('</p><p class="govuk-body">') + '</p><h3 class="govuk-heading-s govuk-!-margin-top-6">' + listContent.judgmentsTitle + '</h3><p class="govuk-body">' + listContent.judgmentsText + '</p>',
      open: true
    }) }}
    {% else %}
    {# For all other list types (14-17) #}
    {# 1. FaCT link #}
    {% if listContent.factLinkText %}
    <p class="govuk-body">
      <a href="{{ listContent.factLinkUrl }}" class="govuk-link">{{ listContent.factLinkText }}</a> {{ listContent.factAdditionalText }}
    </p>
    {% endif %}

    {# 2. Address for King's Bench Division (14), King's Bench Masters (15), Senior Courts Costs Office (17) #}
    {% if listTypeId == 14 or listTypeId == 15 or listTypeId == 17 %}
    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-bottom-0">{{ listContent.locationLine1 }}</p>
    <p class="govuk-body govuk-!-margin-bottom-0">{{ listContent.locationLine2 }}</p>
    <p class="govuk-body">{{ listContent.locationLine3 }}</p>
    {% endif %}

    {# 2. Address for Mayor & City (16) - has 4 lines #}
    {% if listTypeId == 16 %}
    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-bottom-0">{{ listContent.locationLine1 }}</p>
    <p class="govuk-body govuk-!-margin-bottom-0">{{ listContent.locationLine2 }}</p>
    <p class="govuk-body govuk-!-margin-bottom-0">{{ listContent.locationLine3 }}</p>
    <p class="govuk-body">{{ listContent.locationLine4 }}</p>
    {% endif %}

    {# 3. Dates #}
    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-bottom-1">{{ header.listDate }}</p>
    <p class="govuk-body">{{ header.lastUpdated }}</p>

    {# Important information details for Civil Courts at the RCJ - List Type ID 10 #}
    {% if listTypeId == 10 %}
    {{ govukDetails({
      summaryText: listContent.importantInfoTitle,
      html: '<p class="govuk-body">' + listContent.mediaInquiriesText + '</p><p class="govuk-body">' + listContent.openJusticeText + '</p><p class="govuk-body">' + listContent.courtExclusionText + '</p>',
      open: true
    }) }}
    {% endif %}

    {# Important information details for County Court Central London - List Type ID 11 #}
    {% if listTypeId == 11 %}
    {{ govukDetails({
      summaryText: listContent.importantInfoTitle,
      html: '<p class="govuk-body">' + listContent.hearingsInfoText + '</p><p class="govuk-body">' + listContent.mediaAndObserversText + '</p>',
      open: true
    }) }}
    {% endif %}

    {# Important information details for King's Bench Division - List Type ID 14 #}
    {% if listTypeId == 14 %}
    {{ govukDetails({
      summaryText: listContent.importantInfoTitle,
      html: '<h3 class="govuk-heading-s govuk-!-margin-bottom-2">' + listContent.remoteHearingsTitle + '</h3><p class="govuk-body">' + listContent.remoteHearingsText.split('\n\n').join('</p><p class="govuk-body">') + '</p><h3 class="govuk-heading-s govuk-!-margin-top-6 govuk-!-margin-bottom-2">' + listContent.remoteJudgmentsTitle + '</h3><p class="govuk-body">' + listContent.remoteJudgmentsText.split('\n\n').join('</p><p class="govuk-body">') + '</p><h3 class="govuk-heading-s govuk-!-margin-top-6 govuk-!-margin-bottom-2">' + listContent.bundlesTitle + '</h3><p class="govuk-body">' + listContent.bundleFilingText + '</p>',
      open: true
    }) }}
    {% endif %}

    {# Important information details for King's Bench Masters - List Type ID 15 #}
    {% if listTypeId == 15 %}
    {{ govukDetails({
      summaryText: listContent.importantInfoTitle,
      html: '<h3 class="govuk-heading-s govuk-!-margin-bottom-2">' + listContent.pressAndPublicTitle + '</h3><p class="govuk-body">' + listContent.pressAndPublicText.split('\n\n').join('</p><p class="govuk-body">') + '</p><h3 class="govuk-heading-s govuk-!-margin-top-6 govuk-!-margin-bottom-2">' + listContent.judgmentsTitle + '</h3><p class="govuk-body">' + listContent.judgmentsText + '</p><h3 class="govuk-heading-s govuk-!-margin-top-6 govuk-!-margin-bottom-2">' + listContent.bundlesTitle + '</h3><p class="govuk-body">' + listContent.bundlesText.split('\n\n').join('</p><p class="govuk-body">') + '</p><h3 class="govuk-heading-s govuk-!-margin-top-6 govuk-!-margin-bottom-2">' + listContent.inPersonHearingsTitle + '</h3><p class="govuk-body">' + listContent.inPersonHearingsText + '</p><p class="govuk-body govuk-!-margin-top-6"><a href="' + listContent.kbGuideLinkUrl + '" class="govuk-link">' + listContent.kbGuideLinkText + '</a></p><p class="govuk-body"><a href="' + listContent.trialWindowsLinkUrl + '" class="govuk-link">' + listContent.trialWindowsLinkText + '</a></p>',
      open: true
    }) }}
    {% endif %}

    {# Important information details for Mayor & City - List Type ID 16 #}
    {% if listTypeId == 16 %}
    {{ govukDetails({
      summaryText: listContent.importantInfoTitle,
      html: '<p class="govuk-body">' + listContent.hearingsInfoText + '</p><p class="govuk-body">' + listContent.mediaAndObserversText + '</p>',
      open: true
    }) }}
    {% endif %}

    {# Important information details for Senior Courts Costs Office - List Type ID 17 #}
    {% if listTypeId == 17 %}
    {{ govukDetails({
      summaryText: listContent.importantInfoTitle,
      html: '<p class="govuk-body">' + listContent.importantInfoText.split('\n\n').join('</p><p class="govuk-body">') + '</p><p class="govuk-body">' + listContent.moreInfoLinkText + ' <a href="' + listContent.moreInfoLinkUrl + '" class="govuk-link">' + listContent.moreInfoLinkUrl + '</a>.</p>',
      open: true
    }) }}
    {% endif %}
    {% endif %}

    <div class="govuk-form-group search-container">
      <h2 class="govuk-heading-s">{{ common.searchCasesTitle }}</h2>
      <label class="govuk-label govuk-visually-hidden" for="case-search-input">
        {{ common.searchCasesLabel }}
      </label>
      <input class="govuk-input govuk-!-width-one-half" id="case-search-input" name="search" type="text" aria-label="{{ common.searchCasesLabel }}">
    </div>

    <div id="hearings-table-container">
      <table class="govuk-table" id="hearings-table" role="table" aria-label="{{ header.listTitle }}">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th scope="col" class="govuk-table__header">{{ common.tableHeaders.venue }}</th>
            <th scope="col" class="govuk-table__header">{{ common.tableHeaders.judge }}</th>
            <th scope="col" class="govuk-table__header">{{ common.tableHeaders.time }}</th>
            <th scope="col" class="govuk-table__header">{{ common.tableHeaders.caseNumber }}</th>
            <th scope="col" class="govuk-table__header">{{ common.tableHeaders.caseDetails }}</th>
            <th scope="col" class="govuk-table__header">{{ common.tableHeaders.hearingType }}</th>
            <th scope="col" class="govuk-table__header">{{ common.tableHeaders.additionalInformation }}</th>
          </tr>
        </thead>
        <tbody class="govuk-table__body">
          {% for hearing in hearings %}
            <tr class="govuk-table__row">
              <td class="govuk-table__cell">{{ hearing.venue }}</td>
              <td class="govuk-table__cell">{{ hearing.judge }}</td>
              <td class="govuk-table__cell">{{ hearing.time }}</td>
              <td class="govuk-table__cell">{{ hearing.caseNumber }}</td>
              <td class="govuk-table__cell">{{ hearing.caseDetails }}</td>
              <td class="govuk-table__cell">{{ hearing.hearingType }}</td>
              <td class="govuk-table__cell">{{ hearing.additionalInformation }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <p class="govuk-body-s govuk-!-margin-top-6">{{ common.dataSource }}: {{ dataSource }}</p>

    <div class="back-to-top">
      <a href="#top" class="govuk-link">{{ common.backToTop }}</a>
    </div>

  </div>
</div>

<script>
  // Client-side search functionality
  (function() {
    const searchInput = document.getElementById('case-search-input');
    const tableRows = document.querySelectorAll('#hearings-table tbody tr');

    if (!searchInput || !tableRows.length) return;

    searchInput.addEventListener('input', function(e) {
      const query = e.target.value.toLowerCase().trim();

      tableRows.forEach(function(row) {
        const text = row.textContent.toLowerCase();
        const matches = !query || text.includes(query);
        row.style.display = matches ? '' : 'none';
      });
    });
  })();
</script>
{% endblock %}
